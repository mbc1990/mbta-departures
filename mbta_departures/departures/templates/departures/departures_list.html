<head>
    <title>
        MBTA Departures
    </title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <script src="https://use.fontawesome.com/5f5c2f0c6d.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

    <script>
        $(document).ready(function() {
            function DeparturesViewModel(departures) {
                var self=this;
                self.departures = ko.observableArray(departures);

                // Polling frequency in seconds 
                self.POLLING_FREQUENCY = 30; 

                console.log('departures: ',self.departures());
            }

            // TODO: 
            DeparturesViewModel.prototype.pollForUpdates = function() {
                var self=this;
            }

            // The safe template tag prevents html escaping 
            // Let's assume a train will never go to a destination named after an XSS attack... 
            ko.applyBindings(new DeparturesViewModel({{ json_departures|safe }}));
        });
    </script>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>MBTA Departures <i class="fa fa-train" aria-hidden="true"></i></h1>
            </div>
            <div class="col-md-2">
            </div>
            <div class="col-md-8">
                <table style="width:100%">
                    <thead>
                        <tr>
                            <th>
                                Carrier
                            </th>
                            <th>
                                Departure Time
                            </th>
                            <th>
                                Destination
                            </th>
                            <th>
                                Train Number
                            </th>
                            <th>
                                Track 
                            </th>
                            <th>
                                Status 
                            </th>
                        </tr>
                    </thead>
                    <tbody data-bind="foreach:departures">
                        <tr>                        
                            <th>
                                MBTA 
                            </th>
                            <th>
                                <span data-bind="text:$data.scheduled_time"></span>
                            </th>
                            <th>
                                <span data-bind="text:$data.destination"></span>
                            </th>
                            <th>
                                <span data-bind="text:$data.trip"></span>
                            </th>
                            <th>
                                <span data-bind="text:$data.track"></span>
                            </th>
                            <th>
                                <span data-bind="text:$data.status"></span>
                            </th>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="col-md-2">
            </div>
        </div>
    </div>
</body>
